# market-go

┌─────────────────┐    ┌───────────────────────────────────┐    ┌──────────────┐
│   Клиентское    │───▶│          API Gateway             │───▶│   Сервис     │
│   Приложение    │    │ (Auth, Rate Limiting, Routing)   │    │  Пользователей│
│ (Web, Mobile)   │◀───│                                   │◀───│              │
└─────────────────┘    └───────────────────────────────────┘    └──────────────┘
                                │                                   │
                                │                                   │
                                ▼                                   ▼
                     ┌─────────────────────┐             ┌─────────────────────┐
                     │   Сервис Торговли   │────────────▶│     Сервис Данных   │
                     │  (Orders, Portfolio)│             │   (Market Data)     │
                     └─────────────────────┘             └─────────────────────┘
                                │                                   │
                                ▼                                   ▼
                     ┌─────────────────────┐             ┌─────────────────────┐
                     │    Тинькофф API     │             │     Кэш (Redis)     │
                     │     (Брокерский)    │             │   База Данных (PG)  │
                     └─────────────────────┘             └─────────────────────┘


3.1. Клиентское Приложение (Frontend)
Web: React, Vue.js, Angular. Для реального времени — WebSockets.

Mobile: React Native, Flutter, нативные (Kotlin/Swift).

Общение с бекендом: через API Gateway по HTTPS.

3.2. API Gateway
Критически важный компонент. Выполняет:

Аутентификация и Авторизация: Проверка JWT-токенов.

Rate Limiting: Ограничение числа запросов с одного клиента.

Маршрутизация: Перенаправление запросов на соответствующие сервисы (/api/users/* -> User Service, /api/trade/* -> Trade Service).

Кэширование: Кэширование статичных или редко меняющихся данных (например, список инструментов).

Логирование: Централизованный сбор логов.

Технологии: Netflix Zuul, Spring Cloud Gateway, Kong, AWS API Gateway, Nginx.

3.3. Сервис Пользователей (User Service)
Регистрация, аутентификация (логин/пароль, OAuth).

Управление профилями.

Привязка и хранение токенов доступа к Тинькофф API ( в зашифрованном виде! ).

База данных: PostgreSQL или MongoDB.

3.4. Сервис Данных (Market Data Service)
Этот сервис должен быть оптимизирован для работы с большими потоками данных.

Задачи:

Подписка на стаканы и свечи: Постоянное подключение к Stream API Тинькофф для получения рыночных данных.

Кэширование: Активные стаканы, последние свечи по популярным инструментам хранятся в Redis для мгновенного доступа.

Агрегация и обогащение данных: Рассчет технических индикаторов (SMA, RSI и т.д.).

Уведомления: Отправка событий через брокер сообщений (Kafka, RabbitMQ) о значительных изменениях цены.

Архитектура внутри сервиса:

text
┌─────────────┐  Stream  ┌─────────────┐  Сообщения  ┌─────────────┐
│ Tinkoff     │─────────▶│  Data       │────────────▶│  Message    │
│ Stream API  │          │  Aggregator │             │  Broker     │
└─────────────┘          └─────────────┘             └─────────────┘
                                    │                       │
                                    ▼                       ▼
                            ┌─────────────┐         ┌─────────────┐
                            │   Redis     │         │  Streaming  │
                            │  (Cache)    │         │  Clients    │
                            └─────────────┘         └─────────────┘
Технологии: Go, Python (asyncio), Java (Spring Reactor). Redis для кэша, Kafka для надежной передачи событий.

3.5. Сервис Торговли (Trading Service)
Отвечает за выполнение торговых операций.

Задачи:

Валидация заявок: Проверка достаточности средств, корректности цены и т.д.

Отправка в Tinkoff API: Вызов REST API Тинькофф для выставления/снятия заявок.

Обработка лимитов: Умное распределение запросов, чтобы не превысить лимиты Тинькофф. Использование пула соединений.

Отслеживание статуса: Подписка через Stream API на обновления портфеля и статусов заявок.

Работа с "песочницей": Возможность переключения между боевым и тестовым режимом.

Важно: Этот сервис должен быть идемпотентным. Повторная отправка одинаковой заявки (из-за сетевых сбоев) не должна создавать дубликатов.

Технологии: Java/Spring Boot, Go. PostgreSQL для хранения истории ордеров.